<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mcrutils • mcrutils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mcrutils">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcrutils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9008</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/mcrutils.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mcaselli/mcrutils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="mcrutils_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="mcrutils_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="mcrutils_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="mcrutils_files/datatables-binding-0.34.0/datatables.js"></script><link href="mcrutils_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="mcrutils_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="mcrutils_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><script src="mcrutils_files/jszip-1.13.6/jszip.min.js"></script><link href="mcrutils_files/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="mcrutils_files/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script><script src="mcrutils_files/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script><script src="mcrutils_files/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script><script src="mcrutils_files/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script><link href="mcrutils_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="mcrutils_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="mcrutils_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="mcrutils_files/selectize-0.12.0/selectize.min.js"></script><link href="mcrutils_files/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="mcrutils_files/crosstalk-1.2.2/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>mcrutils</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mcaselli/mcrutils/blob/master/vignettes/mcrutils.Rmd" class="external-link"><code>vignettes/mcrutils.Rmd</code></a></small>
      <div class="d-none name"><code>mcrutils.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mcaselli/mcrutils" class="external-link">mcrutils</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The goal of <code>mcrutils</code> is to provide a grab-bag of utility
functions that I find useful in my own R projects for data cleaning,
analysis, and reporting, including creating and visualizing year-to-date
and quarterly analyses, and customer account status/churn analysis.</p>
</div>
<div class="section level2">
<h2 id="cleaning">Cleaning<a class="anchor" aria-label="anchor" href="#cleaning"></a>
</h2>
<div class="section level3">
<h3 id="normalize-logical-columns">Normalize logical columns<a class="anchor" aria-label="anchor" href="#normalize-logical-columns"></a>
</h3>
<p>For data frames or tibbles that have character or factor columns
storing logical data, as may happen when reading from a database, CSV,
or Excel file, use <code><a href="../reference/normalize_logicals.html">normalize_logicals()</a></code> to find and convert
these columns to logical type. This is a nice one-liner in a
<code>dplyr</code> pipe</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ugly_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  logical_char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"F"</span>, <span class="st">"T"</span><span class="op">)</span>,</span>
<span>  logical_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>, <span class="st">"TRUE"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  non_logical_char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>  non_logical_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mixed_char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"F"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>  mixed_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  numeric_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">2.2</span>, <span class="fl">3.3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ugly_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   logical_char logical_factor non_logical_char non_logical_factor mixed_char</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> T            TRUE           a                x                  T         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> F            FALSE          b                y                  F         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> T            TRUE           c                z                  a         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: mixed_factor &lt;fct&gt;, numeric_col &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">ugly_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/normalize_logicals.html">normalize_logicals</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converted <span style="color: #0000BB;">"logical_char"</span> and <span style="color: #0000BB;">"logical_factor"</span> columns to</span></span>
<span><span class="co">#&gt; logical.</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   logical_char logical_factor non_logical_char non_logical_factor mixed_char</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE         TRUE           a                x                  T         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> FALSE        FALSE          b                y                  F         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> TRUE         TRUE           c                z                  a         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: mixed_factor &lt;fct&gt;, numeric_col &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<div class="section level3">
<h3 id="customer-account-status-churn-and-retention">Customer account status, churn, and retention<a class="anchor" aria-label="anchor" href="#customer-account-status-churn-and-retention"></a>
</h3>
<p><code><a href="../reference/accounts_by_status.html">accounts_by_status()</a></code> categorizes accounts into statuses
based on their order activity (active, new, returning, temporarily lost,
regained and terminally lost) in each time interval (monthly, weekly,
quarterly, etc. are supported). It also produces a running list of
cumulative accounts. This is useful for understanding customer retention
and churn.</p>
<p>The <code>data.frame</code> returned by
<code><a href="../reference/accounts_by_status.html">accounts_by_status()</a></code> quickly gets unwieldy to print, so to
see how it works, let’s make a small example data set with a list of 25
orders from 10 accounts over 6 months.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-30"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  account_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  order_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">order_date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orders</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 25</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ account_id <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "h"<span style="color: #949494;">, </span>"b"<span style="color: #949494;">, </span>"b"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"d"<span style="color: #949494;">, </span>"i"<span style="color: #949494;">, </span>"e"<span style="color: #949494;">, </span>"c"<span style="color: #949494;">, </span>"d"<span style="color: #949494;">, </span>"d"<span style="color: #949494;">, </span>"j"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ order_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2022-01-02<span style="color: #949494;">, </span>2022-01-26<span style="color: #949494;">, </span>2022-02-10<span style="color: #949494;">, </span>2022-02-11<span style="color: #949494;">, </span>2022-02-12…</span></span></code></pre></div>
<p><code><a href="../reference/accounts_by_status.html">accounts_by_status()</a></code> splits the order data by time
periods, and returns the accounts in each status category for each
period as a list-column.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orders</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/accounts_by_status.html">accounts_by_status</a></span><span class="op">(</span><span class="va">account_id</span>, <span class="va">order_date</span>, by <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   period_start period_end              active              new returning</span></span>
<span><span class="co">#&gt; 1   2022-01-01 2022-01-31                b, h             b, h          </span></span>
<span><span class="co">#&gt; 2   2022-02-01 2022-02-28 b, c, d, e, f, i, j c, d, e, f, i, j         b</span></span>
<span><span class="co">#&gt; 3   2022-03-01 2022-03-31                d, f                       d, f</span></span>
<span><span class="co">#&gt; 4   2022-04-01 2022-04-30          d, e, g, h                g         d</span></span>
<span><span class="co">#&gt; 5   2022-05-01 2022-05-31             e, f, h                       e, h</span></span>
<span><span class="co">#&gt; 6   2022-06-01 2022-06-30                f, j                          f</span></span>
<span><span class="co">#&gt;   regained temporarily_lost terminally_lost                cumulative</span></span>
<span><span class="co">#&gt; 1                                                                b, h</span></span>
<span><span class="co">#&gt; 2                         h                    b, h, c, d, e, f, i, j</span></span>
<span><span class="co">#&gt; 3                      e, j         b, c, i    b, h, c, d, e, f, i, j</span></span>
<span><span class="co">#&gt; 4     e, h                f                 b, h, c, d, e, f, i, j, g</span></span>
<span><span class="co">#&gt; 5        f                             d, g b, h, c, d, e, f, i, j, g</span></span>
<span><span class="co">#&gt; 6        j                             e, h b, h, c, d, e, f, i, j, g</span></span></code></pre></div>
<p>If you want the count of accounts in each status category, set
<code>with_counts = TRUE</code> (the lists of account_ids are still
included, we just omit them from the printed output here).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orders</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accounts_by_status.html">accounts_by_status</a></span><span class="op">(</span><span class="va">account_id</span>, <span class="va">order_date</span>, by <span class="op">=</span> <span class="st">"month"</span>, with_counts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">period_start</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"n_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   period_start n_active n_new n_returning n_regained n_temporarily_lost</span></span>
<span><span class="co">#&gt; 1   2022-01-01        2     2           0          0                  0</span></span>
<span><span class="co">#&gt; 2   2022-02-01        7     6           1          0                  1</span></span>
<span><span class="co">#&gt; 3   2022-03-01        2     0           2          0                  2</span></span>
<span><span class="co">#&gt; 4   2022-04-01        4     1           1          2                  1</span></span>
<span><span class="co">#&gt; 5   2022-05-01        3     0           2          1                  0</span></span>
<span><span class="co">#&gt; 6   2022-06-01        2     0           1          1                  0</span></span>
<span><span class="co">#&gt;   n_terminally_lost n_cumulative</span></span>
<span><span class="co">#&gt; 1                 0            2</span></span>
<span><span class="co">#&gt; 2                 0            8</span></span>
<span><span class="co">#&gt; 3                 3            8</span></span>
<span><span class="co">#&gt; 4                 0            9</span></span>
<span><span class="co">#&gt; 5                 2            9</span></span>
<span><span class="co">#&gt; 6                 2            9</span></span></code></pre></div>
<p>Visualizing the count of accounts in each status over time can be
helpful to understand how the business is doing in terms of customer
retention and churn.</p>
<p><code>mcrutils</code> includes a larger example dataset
<code>example_sales</code> with about 5000 orders between accounts over
in the 2022–2024 time period.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_sales</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 5,317</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ account_id    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "l_10"<span style="color: #949494;">, </span>"l_11"<span style="color: #949494;">, </span>"l_20"<span style="color: #949494;">, </span>"l_9"<span style="color: #949494;">, </span>"l_1"<span style="color: #949494;">, </span>"l_1"<span style="color: #949494;">, </span>"l_18"<span style="color: #949494;">, </span>"l_…</span></span>
<span><span class="co">#&gt; $ market        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Germany"<span style="color: #949494;">, </span>"Germany"<span style="color: #949494;">, </span>"United States"<span style="color: #949494;">, </span>"United States"<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ order_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2022-01-02<span style="color: #949494;">, </span>2022-01-03<span style="color: #949494;">, </span>2022-01-03<span style="color: #949494;">, </span>2022-01-03<span style="color: #949494;">, </span>2022-01…</span></span>
<span><span class="co">#&gt; $ units_ordered <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">,</span>…</span></span></code></pre></div>
<p><code><a href="../reference/accounts_by_status.html">accounts_by_status()</a></code> produces six status counts, plus
one cumulative count– that’s up to seven data series to plot, so we need
to be thoughtful about design choices.</p>
<p>Showing the lost accounts as a negative value helps de-clutter the
picture and helps perception by encoding values above the axis as “good”
and below as “bad” (assuming we don’t want to lose customers). We can
use color to help as well (blues/greens: good, reds: bad).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">example_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accounts_by_status.html">accounts_by_status</a></span><span class="op">(</span><span class="va">account_id</span>, <span class="va">order_date</span>, with_counts <span class="op">=</span> <span class="cn">TRUE</span>, by <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">period_start</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"n_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># negate the lost counts for visualization</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"lost"</span><span class="op">)</span>, <span class="op">~</span> <span class="op">-</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># pivot to prepare for ggplot</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"n_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"status"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">status</span>, <span class="st">"n_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">period_start</span>, <span class="va">count</span>, color <span class="op">=</span> <span class="va">status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"active"</span> <span class="op">=</span> <span class="st">"#1f78b4"</span>,</span>
<span>    <span class="st">"new"</span> <span class="op">=</span> <span class="st">"#33a02c"</span>,</span>
<span>    <span class="st">"returning"</span> <span class="op">=</span> <span class="st">"#a6cee3"</span>,</span>
<span>    <span class="st">"temporarily_lost"</span> <span class="op">=</span> <span class="st">"#fb9a99"</span>,</span>
<span>    <span class="st">"terminally_lost"</span> <span class="op">=</span> <span class="st">"#e31a1c"</span>,</span>
<span>    <span class="st">"regained"</span> <span class="op">=</span> <span class="st">"#b2df8a"</span>,</span>
<span>    <span class="st">"cumulative"</span> <span class="op">=</span> <span class="st">"#999999"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/manual_accounts_plot-1.png" width="700"></p>
<p><code><a href="../reference/plot_accounts_by_status.html">plot_accounts_by_status()</a></code> is a convenience function that
does the above and a bit more, cleaning up the legend, x-axis title, and
if the last order_date is before the end of the final time period (as in
<code>example_sales</code>, which has no orders after 2024-12-20), the
final period will be shown with dashed lines to indicate that the data
may be incomplete.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_accounts_by_status.html">plot_accounts_by_status</a></span><span class="op">(</span><span class="va">account_id</span>, <span class="va">order_date</span>, by <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/plot_accounts_1-1.png" width="700"></p>
<p>You can suppress the dashed lines for incomplete periods with with
<code>force_final_period_complete = TRUE</code>, and exclude the
cumulative line with <code>include_cumulative = FALSE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_accounts_by_status.html">plot_accounts_by_status</a></span><span class="op">(</span></span>
<span>    <span class="va">account_id</span>, <span class="va">order_date</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>    force_final_period_complete <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    include_cumulative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/plot_accounts_2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="business-day-evaluation">Business day evaluation<a class="anchor" aria-label="anchor" href="#business-day-evaluation"></a>
</h3>
<p><code>mcrutils</code> provides several functions for working with
business days, including <code><a href="../reference/is_bizday.html">is_bizday()</a></code>,
<code><a href="../reference/adjust_to_bizday.html">adjust_to_bizday()</a></code>, <code><a href="../reference/bizdays_between.html">bizdays_between()</a></code>,
<code><a href="../reference/periodic_bizdays.html">periodic_bizdays()</a></code>, and
<code><a href="../reference/bizday_of_period.html">bizday_of_period()</a></code>.</p>
<p>These functions use calendars from QuantLib for working/non-working
day definitions, and they are all based on the <a href="https://github.com/qlcal/qlcal-r" class="external-link">qlcal</a>
package. In fact, with the exception of <code><a href="../reference/periodic_bizdays.html">periodic_bizdays()</a></code>,
there are corresponding functions in <a href="https://github.com/qlcal/qlcal-r" class="external-link">qlcal</a>.</p>
<p>The motivation for the <code>mcrutils</code> versions was to
facilitate frequent changes to the configured QuantLib calendar without
making persistent changes to the globally configured calendar,i.e. these
functions contain the calendar change to their own functional scope.</p>
<p>This functionality leverages <a href="https://withr.r-lib.org" class="external-link">withr</a>.
<code>mcrutils</code> also provides <code><a href="../reference/set_cal.html">with_calendar()</a></code> and
<code><a href="../reference/set_cal.html">local_calendar()</a></code> functions so you can leverage this
side-effect encapsulation for other <code>qlcal</code> use cases.</p>
</div>
<div class="section level3">
<h3 id="business-days-in-periodic-intervals">Business days in periodic intervals<a class="anchor" aria-label="anchor" href="#business-days-in-periodic-intervals"></a>
</h3>
<p><code><a href="../reference/periodic_bizdays.html">periodic_bizdays()</a></code> calculates the number of business
days in each periodic interval (e.g., monthly, quarterly) between two
dates, using calendars from QuantLib for holiday definitions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/periodic_bizdays.html">periodic_bizdays</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="st">"2025-01-01"</span>,</span>
<span>  to <span class="op">=</span> <span class="st">"2025-12-31"</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>  quantlib_calendars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UnitedStates"</span>, <span class="st">"UnitedKingdom"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   calendar      start      end        business_days</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> UnitedStates  2025-01-01 2025-03-31            61</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> UnitedStates  2025-04-01 2025-06-30            63</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> UnitedStates  2025-07-01 2025-09-30            64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> UnitedStates  2025-10-01 2025-12-31            62</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> UnitedKingdom 2025-01-01 2025-03-31            63</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> UnitedKingdom 2025-04-01 2025-06-30            61</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> UnitedKingdom 2025-07-01 2025-09-30            65</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> UnitedKingdom 2025-10-01 2025-12-31            64</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cumulative-daily-sales-by-business-day-of-period">Cumulative daily sales by business day of period<a class="anchor" aria-label="anchor" href="#cumulative-daily-sales-by-business-day-of-period"></a>
</h3>
<p><code><a href="../reference/bizday_of_period.html">bizday_of_period()</a></code> calculates the business day of the
period (month, quarter, or year) for a given date and calendar e.g. date
x is the 3rd business day of the month.</p>
<p>This can be helpful in creating an apples-to-apples “burn-up” chart
showing cumulative orders, revenue, etc through the period vs. a similar
period in a prior year.</p>
<p>When there are multiple records per day, it’s generally faster to
create a lookup table from date to business day of period, and then join
that to your data frame.</p>
<p>Using the <code>example_sales</code> dataset, first we add a column
with the QuantLib calendar to be used for each order (in this case the
market column is close, we just need to eliminate the space in “United
States”).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sales</span> <span class="op">&lt;-</span> <span class="va">example_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>calendar <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">market</span>, <span class="st">" "</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sales</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   account_id market        order_date units_ordered calendar    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> l_10       Germany       2022-01-02             1 Germany     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> l_11       Germany       2022-01-03             4 Germany     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> l_20       United States 2022-01-03             2 UnitedStates</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> l_9        United States 2022-01-03             1 UnitedStates</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> l_1        Germany       2022-01-04             3 Germany     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> l_1        Germany       2022-01-04             2 Germany</span></span></code></pre></div>
<p>Now we can make a lookup table covering the years and markets in our
data set.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bizday_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="co"># make a row for each date in the years spanned by the sales data</span></span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>    from <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sales</span><span class="op">$</span><span class="va">order_date</span><span class="op">)</span>, <span class="st">"month"</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">ceiling_date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sales</span><span class="op">$</span><span class="va">order_date</span><span class="op">)</span>, <span class="st">"month"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"day"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># cross with each calendar</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>calendar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sales</span><span class="op">$</span><span class="va">calendar</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    adjusted_date <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_vec</a></span><span class="op">(</span></span>
<span>      <span class="va">.data</span><span class="op">$</span><span class="va">date</span>, <span class="va">.data</span><span class="op">$</span><span class="va">calendar</span>,</span>
<span>      \<span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span><span class="op">)</span> <span class="fu"><a href="../reference/adjust_to_bizday.html">adjust_to_bizday</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># calculate the business day of month for each date in each market</span></span>
<span>    bizday_of_month <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_int</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">adjusted_date</span>, <span class="va">.data</span><span class="op">$</span><span class="va">calendar</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/bizday_of_period.html">bizday_of_period</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span>, period <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># and again for the business day of quarter</span></span>
<span>    bizday_of_quarter <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_int</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">adjusted_date</span>, <span class="va">.data</span><span class="op">$</span><span class="va">calendar</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="../reference/bizday_of_period.html">bizday_of_period</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">calendar</span>, period <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># peek at the result</span></span>
<span><span class="va">bizday_lookup</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2023-07-02"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># starting on a Sunday in July</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   date       calendar     adjusted_date bizday_of_month bizday_of_quarter</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2023-07-02 Germany      2023-07-03                  1                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2023-07-02 UnitedStates 2023-07-03                  1                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2023-07-03 Germany      2023-07-03                  1                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2023-07-03 UnitedStates 2023-07-03                  1                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2023-07-04 Germany      2023-07-04                  2                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2023-07-04 UnitedStates 2023-07-05                  2                 2</span></span></code></pre></div>
<p>Now we can join the lookup table to the sales data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales_with_bizday</span> <span class="op">&lt;-</span> <span class="va">sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bizday_lookup</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"order_date"</span> <span class="op">=</span> <span class="st">"date"</span>, <span class="st">"calendar"</span> <span class="op">=</span> <span class="st">"calendar"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sales_with_bizday</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   account_id market        order_date units_ordered calendar     adjusted_date</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> l_10       Germany       2022-01-02             1 Germany      2022-01-03   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> l_11       Germany       2022-01-03             4 Germany      2022-01-03   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> l_20       United States 2022-01-03             2 UnitedStates 2022-01-03   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> l_9        United States 2022-01-03             1 UnitedStates 2022-01-03   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> l_1        Germany       2022-01-04             3 Germany      2022-01-04   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> l_1        Germany       2022-01-04             2 Germany      2022-01-04   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: bizday_of_month &lt;int&gt;, bizday_of_quarter &lt;int&gt;</span></span></span></code></pre></div>
<p>Let’s imagine it’s mid-November 2024, and we want to see how orders
are tracking against the prior year.</p>
<p>First we group by the year and business day of month, then calculate
daily units ordered and the cumulative sum of units ordered</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_cum_daily_sales</span> <span class="op">&lt;-</span> <span class="va">sales_with_bizday</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">order_date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2024-11-18"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">adjusted_date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">adjusted_date</span><span class="op">)</span>, <span class="va">bizday_of_month</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>units_ordered <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">units_ordered</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumulative_units_ordered <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">units_ordered</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">global_cum_daily_sales</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   year [1]</span></span></span>
<span><span class="co">#&gt;    year bizday_of_month units_ordered cumulative_units_ordered</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>022               1            24                       24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>022               2            10                       34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>022               3            15                       49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>022               4            15                       64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>022               5            19                       83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>022               6             8                       91</span></span></code></pre></div>
<p>Now we can construct a cumulative daily sales chart comparing 2024 to
prior years.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_cum_daily_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">bizday_of_month</span>, <span class="va">cumulative_units_ordered</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative Units Ordered by Business Day of Month"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Year"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Or we can look by-market as well, we just need to add another
grouping variable for the market, then facet the plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_cum_daily_sales</span> <span class="op">&lt;-</span> <span class="va">sales_with_bizday</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">order_date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2024-11-18"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">order_date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">order_date</span><span class="op">)</span>, <span class="va">bizday_of_month</span>, <span class="va">market</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>units_ordered <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">units_ordered</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">market</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumulative_units_ordered <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">units_ordered</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">regional_cum_daily_sales</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   year, market [2]</span></span></span>
<span><span class="co">#&gt;    year bizday_of_month market        units_ordered cumulative_units_ordered</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>022               1 Germany                   7                        7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>022               1 United States            17                       17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>022               2 Germany                   3                       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>022               2 United States             7                       24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>022               3 Germany                   2                       12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>022               3 United States            13                       37</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_cum_daily_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">bizday_of_month</span>, <span class="va">cumulative_units_ordered</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">market</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative Units Ordered by Business Day of Month"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Year"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="year-to-date-helpers">Year-to-date helpers<a class="anchor" aria-label="anchor" href="#year-to-date-helpers"></a>
</h3>
<p><code>mcrutils</code> provides a handful functions that can be
helpful in creating year-to-date analyses</p>
<p>Below we have 2.5 years of historical sales data ending on June 1,
2025.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2025-06-01"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"month"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">30</span>, lambda <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sales</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   date       amount</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2023-01-01     94</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2023-02-01    111</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2023-03-01     83</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2023-04-01    101</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2023-05-01    117</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2023-06-01    104</span></span></code></pre></div>
<p><code><a href="../reference/ytd_bounds.html">ytd_bounds()</a></code> gets the start and end of the year-to-date
period for the latest year in a vector of dates,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ytd_bounds.html">ytd_bounds</a></span><span class="op">(</span><span class="va">sales</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-01-01" "2025-06-01"</span></span></code></pre></div>
<p>and <code><a href="../reference/is_ytd_comparable.html">is_ytd_comparable()</a></code> is a logical vector that
indicates whether the dates in a vector are within a year-to-date period
relative to a given <code>end_date</code>.</p>
<p>So we can quickly filter the historical data to see how we’re doing
in 2025 compared to the same period (i.e. January - June) in 2023 and
2024:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/is_ytd_comparable.html">is_ytd_comparable</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ytd_sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">amount</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;    year ytd_sales</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>023       610</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>024       594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>025       600</span></span></code></pre></div>
<p>With <code><a href="../reference/py_dates.html">py_dates()</a></code> you can rollback a vector of dates to
the same period in the previous year, moving any fictitious dates to the
prior valid day.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2024-01-01"</span>, <span class="st">"2024-02-29"</span>, <span class="st">"2025-07-15"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/py_dates.html">py_dates</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2023-01-01" "2023-02-28" "2024-07-15"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<div class="section level3">
<h3 id="auto-formatted-datattables">Auto-formatted datattables<a class="anchor" aria-label="anchor" href="#auto-formatted-datattables"></a>
</h3>
<p><code><a href="../reference/auto_dt.html">auto_dt()</a></code> uses <code><a href="../reference/guess_col_fmts.html">guess_col_fmts()</a></code> to
determine the format of each column. You can provide
<code>pct_flags</code> and <code>curr_flags</code> (character vectors)
if you need to control the list of “signal” words that indicate a column
is a percentage or currency.</p>
<p>You can suppress the buttons for copy, csv, and excel downloads with
<code>buttons = FALSE</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">product</span>, <span class="op">~</span><span class="va">weight</span>, <span class="op">~</span><span class="va">dollaz_earned</span>, <span class="op">~</span><span class="va">growth_pct</span>,</span>
<span>  <span class="st">"Widget A"</span>, <span class="fl">13.53</span>, <span class="fl">1023.21</span>, <span class="fl">0.051</span>,</span>
<span>  <span class="st">"Widget B"</span>, <span class="fl">22.61</span>, <span class="fl">150.24</span>, <span class="fl">0.103</span>,</span>
<span>  <span class="st">"Widget C"</span>, <span class="fl">40.54</span>, <span class="fl">502.26</span>, <span class="fl">0.021</span>,</span>
<span>  <span class="st">"Widget D"</span>, <span class="fl">34.21</span>, <span class="fl">2000.95</span>, <span class="fl">0.154</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/auto_dt.html">auto_dt</a></span><span class="op">(</span>numeric_digits <span class="op">=</span> <span class="fl">1</span>, pct_digits <span class="op">=</span> <span class="fl">0</span>, curr_flags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"revenue"</span>, <span class="st">"dollaz"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Widget A&quot;,&quot;Widget B&quot;,&quot;Widget C&quot;,&quot;Widget D&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"13.53\" data-max=\"40.54\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"150.24\" data-max=\"2000.95\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.021\" data-max=\"0.154\" data-scale=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"data":[["Widget A","Widget B","Widget C","Widget D"],[13.53,22.61,40.54,34.21],[1023.21,150.24,502.26,2000.95],[0.051,0.103,0.021,0.154]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>product<\/th>\n      <th>weight<\/th>\n      <th>dollaz_earned<\/th>\n      <th>growth_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","buttons":["copy",{"extend":"collection","buttons":["csv","excel"],"text":"Download"}],"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 0, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3]},{"name":"product","targets":0},{"name":"weight","targets":1},{"name":"dollaz_earned","targets":2},{"name":"growth_pct","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="quarterly-breaks-and-labels">Quarterly breaks and labels<a class="anchor" aria-label="anchor" href="#quarterly-breaks-and-labels"></a>
</h3>
<p><code><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">scales::label_date_short()</a></code> is a great function for
labeling dates in <code>ggplot2</code>, but unfortunately it can’t
support quarterly breaks and labels out of the box.</p>
<p><code>mcrutils</code> provides a set of functions to create quarterly
breaks and labels for date scales in <code>ggplot2</code>. The
<code><a href="../reference/breaks_quarters.html">breaks_quarters()</a></code> function generates breaks for quarters,
and <code><a href="../reference/label_quarters_short.html">label_quarters_short()</a></code> generates minimal labels for
these breaks in a two-line format (like
<code><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">scales::label_date_short()</a></code>), labeling every quarter, but
only including the year when it changes from the previous label.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">economics</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2005-05-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2007-03-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">pce</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="../reference/breaks_quarters.html">breaks_quarters</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="../reference/label_quarters_short.html">label_quarters_short</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Automatic Quarterly Breaks"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"with concise labels"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/automatic-quarterly-breaks-1.png" width="700"></p>
<p>The automatic version of <code><a href="../reference/breaks_quarters.html">breaks_quarters()</a></code> tries to
return a reasonable number of breaks over a wide range of dates,
down-sampling to semesters and years as needed.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">economics</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2005-05-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2009-03-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">pce</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="../reference/breaks_quarters.html">breaks_quarters</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="../reference/label_quarters_short.html">label_quarters_short</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Switching to semesters for longer ranges"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"always labelling Q1/Q3, never Q2/Q4"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/semester-breaks-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">economics</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2000-05-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2010-03-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">pce</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="../reference/breaks_quarters.html">breaks_quarters</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="../reference/label_quarters_short.html">label_quarters_short</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Switching to yearly for very long ranges"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"rather silly"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/yearly-breaks-for-long-ranges-1.png" width="700"></p>
<p>With very long date ranges like this, you are likely better off
switching from these quarterly functions to the more standard date
breaks and labels in <code>ggplot2</code>.</p>
<p>You can force a fixed break width if quarters are desired regardless
of the date range.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_sales</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_accounts_by_status.html">plot_accounts_by_status</a></span><span class="op">(</span><span class="va">account_id</span>, <span class="va">order_date</span>, by <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="../reference/breaks_quarters.html">breaks_quarters</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"1 quarter"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="../reference/label_quarters_short.html">label_quarters_short</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcrutils_files/figure-html/fixed-quarterly-breaks-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Caselli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
